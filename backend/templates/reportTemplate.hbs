<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Rapport Patient</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
  <style>
    @page {
      margin: 20mm 15mm;
    }
    body {
      font-family: Georgia, serif;
      font-size: 12px;
      color: #000;
      line-height: 1.6;
      counter-reset: page;
    }
    h1, h2, h3 {
      color: #000;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 20px;
    }
    h2 {
      font-size: 20px;
      margin-top: 0;
      margin-bottom: 10px;
      border-bottom: 2px solid #000;
      padding-bottom: 4px;
    }
    h3 {
      font-size: 16px;
      margin-top: 16px;
      page-break-inside: avoid;
    }
    /* Page de garde */
    .title-page {
      text-align: center;
      margin-top: 200px;
      page-break-after: always;
    }
    .title-page p {
      font-size: 15px;
      margin: 8px 0;
    }
    /* Sommaire */
    .toc-page {
      padding-top: 0;
      page-break-after: always;
    }
    .toc-page h2 {
      font-size: 22px;
      margin-bottom: 10px;
      border-bottom: 2px solid #000;
      padding-bottom: 4px;
    }
    .toc-page ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }
    .toc-page li {
      font-size: 14px;
      margin-bottom: 6px;
    }
    .toc-page a {
      text-decoration: none;
      color: #000;
    }
    /* Sous-sections: indentation et police plus petite */
    .toc-sub {
      padding-left: 30px;
      font-size: 13px;
      margin-top: 4px;
      margin-bottom: 6px;
    }
    .toc-sub p {
      margin: 0 0 4px 0;
    }
    .toc-sub li {
      margin-bottom: 4px;
    }
    /* Chaque section force un saut de page après elle, sauf la dernière */
    /* Chaque section force un saut de page, sauf la dernière */
    .section {
      break-before: page;
    }
    .section:first-of-type {
      break-before: avoid;
    }
    h2 {
      page-break-after: avoid;
    }

    /* Quill / contenu */
    .ql-editor {
      padding: 0;
    }
    .ql-editor > * {
      margin-bottom: 10px;
    }
    .ql-editor p {
      margin: 0 0 8px 0;
    }
    .ql-editor ul {
      list-style: disc;
      margin-left: 20px;
    }
    .ql-editor ol {
      list-style: decimal;
      margin-left: 20px;
    }
    .ql-editor strong {
      font-weight: bold;
    }
    .ql-editor em {
      font-style: italic;
    }
  </style>
</head>
<body>

  <!-- Page de garde -->
  <div class="title-page">
    <h1>Rapport Thérapeutique</h1>
    <p><strong>Patient :</strong> {{patientName}}</p>
    <p><strong>Date de naissance :</strong> {{birthDate}}</p>
    <p><strong>Date du rapport :</strong> {{reportDate}}</p>
    <p><strong>Ergothérapeute :</strong> {{therapistName}}</p>
  </div>

  <!-- Sommaire -->
  <div class="toc-page">
    <h2>Sommaire</h2>
    <ul>
      {{#each reportContent}}
        <li>
          <!-- Lien vers la section principale -->
          <a href="#section-{{@index}}">{{addOne @index}}. {{this.title}}</a>
          <!-- Sous-sections (si présentes) -->
          {{#if this.subsections}}
            <div class="toc-sub">
              {{#each this.subsections}}
                <p>{{this.number}}. {{this.title}}</p>
              {{/each}}
            </div>
          {{/if}}
        </li>
      {{/each}}
    </ul>
  </div>

  <!-- Contenu des sections -->
  {{#each reportContent}}
    <div class="section" id="section-{{@index}}">
      <h2>{{addOne @index}}. {{this.title}}</h2>
      <div class="ql-editor">
        {{{autoNumberSubsections this.content (addOne @index)}}}
      </div>
    </div>
  {{/each}}

</body>
</html>
